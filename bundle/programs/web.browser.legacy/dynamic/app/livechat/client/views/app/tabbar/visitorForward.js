function module(e,t,n){var r,i,s,o,a,c,u,l,d,f,m;n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),n.link("@babel/runtime/regenerator",{default:function(e){i=e}},1),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){s=e}},2),n.link("meteor/meteor",{Meteor:function(e){o=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){a=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){c=e}},2),n.link("meteor/templating",{Template:function(e){u=e}},3),n.link("toastr",{default:function(e){l=e}},4),n.link("../../../../../models",{ChatRoom:function(e){d=e}},5),n.link("../../../../../utils",{t:function(e){f=e}},6),n.link("./visitorForward.html"),n.link("../../../../../utils/client",{APIClient:function(e){m=e}},7),u.visitorForward.helpers({visitor:function(){return u.instance().visitor.get()},agentName:function(){return this.name||this.username},onSelectAgents:function(){return u.instance().onSelectAgents},agentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return"@"+(0===n.length?t:t.replace(new RegExp(e.get()),(function(e){return"<strong>"+e+"</strong>"})))}},agentConditions:function(){var e,t,n=(u.instance().room.get()||{}).servedBy,r=(n=void 0===n?{}:n)._id,i;return{_id:r&&{$ne:r},status:{$ne:"offline"},statusLivechat:"available"}},selectedAgents:function(){return u.instance().selectedAgents.get()},onClickTagAgent:function(){return u.instance().onClickTagAgent},departmentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return""+(0===n.length?t:t.replace(new RegExp(e.get(),"i"),(function(e){return"<strong>"+e+"</strong>"})))}},onClickTagDepartment:function(){return u.instance().onClickTagDepartment},selectedDepartments:function(){return u.instance().selectedDepartments.get()},onSelectDepartments:function(){return u.instance().onSelectDepartments},departmentConditions:function(){var e=u.instance().departmentForwardRestrictions.get();return s({enabled:!0,numAgents:{$gt:0}},e)}}),u.visitorForward.onCreated(function(){function e(){var e=this,t,n;return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return this.visitor=new a,this.room=new a,this.departments=new a([]),this.selectedAgents=new a([]),this.selectedDepartments=new a([]),this.departmentForwardRestrictions=new a({}),this.onSelectDepartments=function(t){var n=t.item;n.text=n.name,e.selectedDepartments.set([n]),e.selectedAgents.set([])},this.onClickTagDepartment=function(){e.selectedDepartments.set([])},this.onSelectAgents=function(t){var n=t.item;e.selectedAgents.set([n]),e.selectedDepartments.set([])},this.onClickTagAgent=function(t){var n=t.username;e.selectedAgents.set(e.selectedAgents.get().filter((function(e){return e.username!==n})))},this.autorun((function(){e.visitor.set(o.users.findOne({_id:u.currentData().visitorId}))})),this.autorun((function(){e.room.set(d.findOne({_id:u.currentData().roomId}));var t,n=e.room.get().departmentId;n&&o.call("livechat:getDepartmentForwardRestrictions",n,(function(t,n){e.departmentForwardRestrictions.set(n)}))})),r.next=14,i.awrap(m.v1.get("livechat/department"));case 14:t=r.sent,n=t.departments,this.departments.set(n);case 17:case"end":return r.stop()}}return r}(),null,this,null,Promise)}return e}()),u.visitorForward.events({"submit form":function(e,t){var n=this;e.preventDefault();var i={roomId:t.room.get()._id,comment:e.target.comment.value},s=t.selectedAgents.get(),a,u=r(s,1)[0];if(u)i.userId=u._id;else if(t.selectedDepartments.get()){var d=t.selectedDepartments.get(),m,g=r(d,1)[0];i.departmentId=g&&g._id}(i.userId||i.departmentId)&&o.call("livechat:transfer",i,(function(e,t){e?l.error(f(e.error)):t?(n.save(),l.success(f("Transferred")),c.go("/")):l.warning(f("No_available_agents_to_transfer"))}))},"click .cancel":function(e){e.preventDefault(),this.cancel()}})}

