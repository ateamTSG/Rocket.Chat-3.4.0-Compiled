function module(e,t,n){var i,s,r,u,a,c,o,l;n.link("@babel/runtime/regenerator",{default:function(e){i=e}},0),n.link("meteor/meteor",{Meteor:function(e){s=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){r=e}},1),n.link("meteor/templating",{Template:function(e){u=e}},2),n.link("../../../../settings",{settings:function(e){a=e}},3),n.link("../../../../authorization",{hasPermission:function(e){c=e}},4),n.link("../../../../models",{Users:function(e){o=e}},5),n.link("./livechatQueue.html"),n.link("../../../../utils/client",{APIClient:function(e){l=e}},6);var f=50;u.livechatQueue.helpers({departments:function(){return u.instance().departments.get().filter((function(e){return!0===e.enabled}))},onSelectAgents:function(){return u.instance().onSelectAgents},agentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return"@"+(0===n.length?t:t.replace(new RegExp(e.get()),(function(e){return"<strong>"+e+"</strong>"})))}},selectedAgents:function(){return u.instance().selectedAgents.get()},onClickTagAgent:function(){return u.instance().onClickTagAgent},queue:function(){return u.instance().queue.get()},isLoading:function(){return u.instance().isLoading.get()},hasPermission:function(){var e=o.findOne(s.userId(),{fields:{statusLivechat:1}});return c(s.userId(),"view-livechat-queue")||"available"===e.statusLivechat&&a.get("Livechat_show_queue_list_link")},hasMore:function(){var e=u.instance(),t=e.queue.get();return e.total.get()>t.length}}),u.livechatQueue.events({"click .show-offline":function(e,t){var n=t.showOffline.get();n[this._id]=e.currentTarget.checked,t.showOffline.set(n)},"submit form":function(e,t){e.preventDefault(),t.queue.set([]),t.offset.set(0);var n={};$(":input",e.currentTarget).each((function(){if(this.name){var e=$(this).val();n[this.name]=e}}));var i=t.selectedAgents.get();i&&i.length>0&&(n.agent=i[0]._id),t.filter.set(n)},"click .js-load-more":function(e,t){t.offset.set(t.offset.get()+f)}}),u.livechatQueue.onCreated(function(){function e(){var e=this,t,n;return i.async(function(){function s(s){for(;;)switch(s.prev=s.next){case 0:return this.selectedAgents=new r([]),this.departments=new r([]),this.limit=new r(20),this.filter=new r({}),this.queue=new r([]),this.isLoading=new r(!0),this.offset=new r(0),this.total=new r(0),this.onSelectAgents=function(t){var n=t.item;e.selectedAgents.set([n])},this.onClickTagAgent=function(t){var n=t.username;e.selectedAgents.set(e.selectedAgents.get().filter((function(e){return e.username!==n})))},this.autorun(function(){function t(){var t,n,s,r,u,a;return i.async(function(){function c(c){for(;;)switch(c.prev=c.next){case 0:return e.isLoading.set(!0),t=e.filter.get(),n=e.offset.get(),s="includeOfflineAgents="+("offline"===t.agentStatus),t.agent&&(s+="&agentId="+t.agent),t.department&&(s+="&departmentId="+t.department),c.next=8,i.awrap(l.v1.get("livechat/queue?"+s+"&count="+f+"&offset="+n));case 8:r=c.sent,u=r.queue,a=r.total,e.total.set(a),e.queue.set(e.queue.get().concat(u)),e.isLoading.set(!1);case 14:case"end":return c.stop()}}return c}(),null,null,null,Promise)}return t}()),s.next=13,i.awrap(l.v1.get('livechat/department?sort={"name": 1}'));case 13:t=s.sent,n=t.departments,this.departments.set(n);case 16:case"end":return s.stop()}}return s}(),null,this,null,Promise)}return e}())}

