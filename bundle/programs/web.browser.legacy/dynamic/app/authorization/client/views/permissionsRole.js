function module(e,t,n){var r,s,o,a,i,u,c,l,m,f,d,h,p,v,g,R,k;n.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){s=e}},1),n.link("meteor/meteor",{Meteor:function(e){o=e}},0),n.link("meteor/reactive-dict",{ReactiveDict:function(e){a=e}},1),n.link("meteor/reactive-var",{ReactiveVar:function(e){i=e}},2),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){u=e}},3),n.link("meteor/templating",{Template:function(e){c=e}},4),n.link("meteor/tracker",{Tracker:function(e){l=e}},5),n.link("toastr",{default:function(e){m=e}},6),n.link("../../../utils/client/lib/handleError",{handleError:function(e){f=e}},7),n.link("../../../utils/lib/tapi18n",{t:function(e){d=e}},8),n.link("../../../models",{Roles:function(e){h=e}},9),n.link("../hasPermission",{hasAllPermission:function(e){p=e}},10),n.link("../../../ui-utils/client/lib/modal",{modal:function(e){v=e}},11),n.link("../../../ui-utils/client/lib/SideNav",{SideNav:function(e){g=e}},12),n.link("../../../utils/client",{APIClient:function(e){R=e}},13),n.link("../../../ui-utils/client",{call:function(e){k=e}},14);var _=50,T=function(){function e(e){var t,n,o,a,i;return r.async(function(){function c(c){for(;;)switch(c.prev=c.next){case 0:return t=e.state.get("offset"),n=e.searchRoom.get(),o=s({role:u.getParam("name"),offset:t,count:_},n&&{roomId:n}),e.state.set("loading",!0),c.next=6,r.awrap(R.v1.get("roles.getUsersInRole",o));case 6:a=c.sent,i=a.users,e.usersInRole.set(e.usersInRole.curValue.concat(i)),e.state.set({loading:!1,hasMore:i.length===_});case 10:case"end":return c.stop()}}return c}(),null,null,null,Promise)}return e}();c.permissionsRole.helpers({role:function(){return h.findOne({_id:u.getParam("name")})||{}},userInRole:function(){return c.instance().usersInRole.get()},editing:function(){return null!=u.getParam("name")},emailAddress:function(){if(this.emails&&this.emails.length>0)return this.emails[0].address},hasPermission:function(){return p("access-permissions")},protected:function(){return this.protected},editable:function(){return this._id&&!this.protected},hasUsers:function(){return c.instance().usersInRole.get().length>0},hasMore:function(){return c.instance().state.get("hasMore")},isLoading:function(){var e=c.instance();return(!e.subscription.ready()||e.state.get("loading"))&&"btn-loading"},searchRoom:function(){return c.instance().searchRoom.get()},autocompleteChannelSettings:function(){return{limit:10,rules:[{collection:"CachedChannelList",endpoint:"rooms.autocomplete.channelAndPrivate",field:"name",template:c.roomSearch,noMatchTemplate:c.roomSearchEmpty,matchAll:!0,sort:"name",selector:function(e){return{name:e}}}]}},autocompleteUsernameSettings:function(){var e=c.instance();return{limit:10,rules:[{collection:"CachedUserList",endpoint:"users.autocomplete",field:"username",template:c.userSearch,noMatchTemplate:c.userSearchEmpty,matchAll:!0,filter:{exceptions:e.usersInRole.get()},selector:function(e){return{term:e}},sort:"username"}]}}}),c.permissionsRole.events({"click .remove-user":function(){function e(e,t){var n=this;return r.async(function(){function s(s){for(;;)switch(s.prev=s.next){case 0:e.preventDefault(),v.open({title:d("Are_you_sure"),text:d("The_user_s_will_be_removed_from_role_s",this.username,u.getParam("name")),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:d("Yes"),cancelButtonText:d("Cancel"),closeOnConfirm:!1,html:!1},function(){function e(){return r.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.awrap(k("authorization:removeUserFromRole",u.getParam("name"),n.username,t.searchRoom.get()));case 2:t.usersInRole.set(t.usersInRole.curValue.filter((function(e){return e.username!==n.username}))),v.open({title:d("Removed"),text:d("User_removed"),type:"success",timer:1e3,showConfirmButton:!1});case 4:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return e}());case 2:case"end":return s.stop()}}return s}(),null,this,null,Promise)}return e}(),"submit #form-role":function(e){var t=this;e.preventDefault();var n=e.currentTarget.elements.save.value;e.currentTarget.elements.save.value=d("Saving");var r={description:e.currentTarget.elements.description.value,scope:e.currentTarget.elements.scope.value,mandatory2fa:e.currentTarget.elements.mandatory2fa.checked};this._id?r.name=this._id:r.name=e.currentTarget.elements.name.value,o.call("authorization:saveRole",r,(function(s){return e.currentTarget.elements.save.value=n,s?f(s):(m.success(d("Saved")),t._id?void 0:u.go("admin-permissions-edit",{name:r.name}))}))},"submit #form-users":function(){function e(e,t){var n;return r.async(function(){function s(s){for(;;)switch(s.prev=s.next){case 0:if(e.preventDefault(),""!==e.currentTarget.elements.username.value.trim()){s.next=3;break}return s.abrupt("return",m.error(d("Please_fill_a_username")));case 3:return n=e.currentTarget.elements.add.value,e.currentTarget.elements.add.value=d("Saving"),s.prev=5,s.next=8,r.awrap(k("authorization:addUserToRole",u.getParam("name"),e.currentTarget.elements.username.value,t.searchRoom.get()));case 8:t.usersInRole.set([]),t.state.set({offset:0,cache:Date.now()}),m.success(d("User_added")),e.currentTarget.reset();case 12:return s.prev=12,e.currentTarget.elements.add.value=n,s.finish(12);case 15:case"end":return s.stop()}}return s}(),null,null,[[5,,12,15]],Promise)}return e}(),"submit #form-search-room":function(e){return e.preventDefault()},"click .delete-role":function(e){if(e.preventDefault(),this.protected)return m.error(d("error-delete-protected-role"));o.call("authorization:deleteRole",this._id,(function(e){if(e)return f(e);m.success(d("Role_removed")),u.go("admin-permissions")}))},"click .load-more":function(e,t){t.state.set("offset",t.state.get("offset")+_)},"autocompleteselect input[name=room]":function(e,t,n){t.searchRoom.set(n._id)}}),c.permissionsRole.onCreated(function(){function e(){return r.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:this.state=new a({offset:0,loading:!1,hasMore:!0,cache:0}),this.searchRoom=new i,this.searchUsername=new i,this.usersInRole=new i([]);case 4:case"end":return e.stop()}}return e}(),null,this,null,Promise)}return e}()),c.permissionsRole.onRendered((function(){var e=this;this.autorun((function(){e.searchRoom.get(),e.usersInRole.set([]),e.state.set({offset:0})})),this.autorun((function(){e.state.get("cache"),T(e)})),l.afterFlush((function(){g.setFlex("adminFlex"),g.openFlex()}))}))}

