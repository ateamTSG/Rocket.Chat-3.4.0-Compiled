function module(e,t,n){var i,r,o,a,u,c,l,d,f,s,v,m,p,b,k,I,g,x,y,E,h,C,w,S,P,A;n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){r=e}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){o=e}},2),n.export({ModalBlock:function(){return D}}),n.link("@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer",{UIKitIncomingInteractionContainerType:function(e){a=e}},0),n.link("@rocket.chat/fuselage",{Modal:function(e){u=e},AnimatedVisibility:function(e){c=e},ButtonGroup:function(e){l=e},Button:function(e){d=e},Box:function(e){f=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){s=e},useUniqueId:function(e){v=e}},2),n.link("@rocket.chat/fuselage-ui-kit",{kitContext:function(e){m=e},UiKitComponent:function(e){p=e},UiKitModal:function(e){b=e},modalParser:function(e){k=e}},3),n.link("@rocket.chat/ui-kit",{uiKitText:function(e){I=e}},4),n.link("react",{default:function(e){g=e},useCallback:function(e){x=e},useEffect:function(e){y=e},useMemo:function(e){E=e},useReducer:function(e){h=e},useRef:function(e){C=e},useState:function(e){w=e}},5),n.link("../../../app/ui-utils/client",{renderMessageBody:function(e){S=e}},6),n.link("../../../app/utils/lib/getURL",{getURL:function(e){P=e}},7),n.link("../../../app/ui-message/client/ActionManager",{"*":function(e){A=e}},8),k.text=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=e.type;return"mrkdwn"!==n?t:g.createElement("span",{dangerouslySetInnerHTML:{__html:S({msg:t})}})};var M=I({plain_text:function(e){var t;return e.text},text:function(e){var t;return e.text}}),U='\n\ta[href]:not([tabindex="-1"]),\n\tarea[href]:not([tabindex="-1"]),\n\tinput:not([disabled]):not([tabindex="-1"]),\n\tselect:not([disabled]):not([tabindex="-1"]),\n\ttextarea:not([disabled]):not([tabindex="-1"]),\n\tbutton:not([disabled]):not([tabindex="-1"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex="-1"]),\n\t[contenteditable]',j='\n\ta[href]:not([tabindex="-1"]):invalid,\n\tarea[href]:not([tabindex="-1"]):invalid,\n\tinput:not([disabled]):not([tabindex="-1"]):invalid,\n\tselect:not([disabled]):not([tabindex="-1"]):invalid,\n\ttextarea:not([disabled]):not([tabindex="-1"]):invalid,\n\tbutton:not([disabled]):not([tabindex="-1"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex="-1"]):invalid,\n\t[contenteditable]:invalid';function D(e){var t=e.view,n=e.errors,i=e.appId,r=e.onSubmit,a=e.onClose,s=e.onCancel,m="modal_id_"+v(),k=C();y((function(){if(k.current)if(n&&Object.keys(n).length){var e=k.current.querySelector(j);e&&e.focus()}else{var t=k.current.querySelector(U);t&&t.focus()}}),[k.current,n]);var I=E((function(){return document.activeElement}),[]);y((function(){return function(){return I&&I.focus()}}),[I]);var h=x((function(e){if(13===e.keyCode)return r(e);if(27===e.keyCode)return e.stopPropagation(),e.preventDefault(),a(),!1;if(9===e.keyCode){var t=Array.from(k.current.querySelectorAll(U)),n,i=o(t,1)[0],u=t.pop();if(!k.current.contains(document.activeElement))return i.focus();if(e.shiftKey)return void(i&&i!==document.activeElement||(u.focus(),e.stopPropagation(),e.preventDefault()));u&&u!==document.activeElement||(i.focus(),e.stopPropagation(),e.preventDefault())}}),[a,r]);return y((function(){var e=document.querySelector(".rc-modal-wrapper"),t=e.querySelector(".rcx-modal__content"),n=function(t){if(t.target===e)return t.preventDefault(),t.stopPropagation(),a(),!1},i=function(e){if(t.contains(e.target))return h(e)};return document.addEventListener("keydown",i),e.addEventListener("click",n),function(){document.removeEventListener("keydown",i),e.removeEventListener("click",n)}}),[h,a]),g.createElement(c,{visibility:c.UNHIDING},g.createElement(u,{open:!0,id:m,ref:k},g.createElement(u.Header,null,g.createElement(u.Thumb,{url:P("/api/apps/"+i+"/icon")}),g.createElement(u.Title,null,M([t.title])),g.createElement(u.Close,{tabIndex:-1,onClick:a})),g.createElement(u.Content,null,g.createElement(f,{is:"form",method:"post",action:"#",onSubmit:r},g.createElement(p,{render:b,blocks:t.blocks}))),g.createElement(u.Footer,null,g.createElement(l,{align:"end"},t.close&&g.createElement(d,{onClick:s},M([t.close.text])),t.submit&&g.createElement(d,{primary:!0,onClick:r},M([t.submit.text]))))))}var L=function(e){var t=w(e),n=o(t,2),a=n[0],u=n[1],c=a.viewId;return y((function(){var e=function(e){var t=e.type,n=r(e,["type"]);if("errors"!==t)u(n);else{var o=n.errors;u(i({},a,{errors:o}))}};return A.on(c,e),function(){A.off(c,e)}}),[c]),a},_=function(e){var t=s((function(e,t){var n,r=t.actionId,o=t.payload;return i({},e,((n={})[r]=o,n))})),n=s((function(){var t=function(e){var n=e.element,i=e.elements,r=void 0===i?[]:i;return!(!n||!n.initialValue)||(!(!r.length||!r.map((function(e){return{element:e}})).filter(t).length)||void 0)},n=function(e){var i=e.element,r=e.blockId,o=e.elements,a=void 0===o?[]:o;return a.length?a.map((function(e){return{element:e,blockId:r}})).filter(t).map(n):[i.actionId,{value:i.initialValue,blockId:r}]};return e.blocks.filter(t).map(n).reduce((function(e,t){var n;if(Array.isArray(t[0]))return i({},e,{},Object.fromEntries(t));var r=o(t,2),a=r[0],u=r[1];return i({},e,((n={})[a]=u,n))}),{})}));return h(t,null,n)};function q(e){var t=L(e),n=t.appId,r=t.viewId,u=t.mid,c=t.errors,l=t.view,d=_(l),f=o(d,2),v=f[0],p=f[1],b=function(e){return Object.entries(e).reduce((function(e,t){var n=o(t,2),i=n[0],r=n[1],a=r.blockId,u=r.value;return e[a]=e[a]||{},e[a][i]=u,e}),{})},k=function(e){e&&((e.nativeEvent||e).stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},I=i({action:function(e){var t=e.actionId,n=e.appId,i=e.value,o=e.blockId,c=e.mid,l=void 0===c?u:c;return A.triggerBlockAction({container:{type:a.VIEW,id:r},actionId:t,appId:n,value:i,blockId:o,mid:l})},state:function(e){var t=e.actionId,n=e.value,i=e.blockId,r;p({actionId:t,payload:{blockId:void 0===i?"default":i,value:n}})}},t,{values:v}),x=s((function(e){k(e),A.triggerSubmitView({viewId:r,appId:n,payload:{view:i({},l,{id:r,state:b(v)})}})})),y=s((function(e){return k(e),A.triggerCancel({appId:n,viewId:r,view:i({},l,{id:r,state:b(v)})})})),E=s((function(e){return k(e),A.triggerCancel({appId:n,viewId:r,view:i({},l,{id:r,state:b(v)}),isCleared:!0})}));return g.createElement(m.Provider,{value:I},g.createElement(D,{view:l,errors:c,appId:n,onSubmit:x,onCancel:y,onClose:E}))}n.exportDefault(q)}

